<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <meta http-equiv="Content-Security-Policy" content="
          default-src 'self';
          script-src 'self' https://cdn.jsdelivr.net 'unsafe-inline';
          style-src 'self' https://fonts.googleapis.com 'unsafe-inline';
          font-src 'self' https://fonts.gstatic.com;
          img-src 'self' https://ac-landing-pages-user-uploads-production.s3.amazonaws.com https://www.tetris-db.com;
          connect-src 'self';
          frame-ancestors 'none';
    ">
    <title>Planificación Logística y Teletrabajo</title>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&family=Roboto:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <!-- Iconos (Material Symbols) -->
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded"
      rel="stylesheet"
    />
    <?!= include('styles'); ?>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <header class="navbar">
      <div class="nav-left">
        <div class="brand">
          <img src="https://ac-landing-pages-user-uploads-production.s3.amazonaws.com/0000107165/6b9853cd-90a0-47a5-80f9-c108e787dfcb.png" alt="Intelcia Logo" class="brand-logo">
        </div>
      </div>

      <button class="nav-toggle" aria-label="Abrir menú">
        <span class="material-symbols-rounded">menu</span>
      </button>

      <nav class="nav-links">
        <a href="#inicio" data-section="inicio" class="nav-link active">
          Inicio
        </a>
        <a href="#proyectos" data-section="proyectos" class="nav-link">
          Proyectos
        </a>
        <a href="#documentacion" data-section="documentacion" class="nav-link">
          Documentación
        </a>
        <a href="#proximos" data-section="proximos" class="nav-link">
          Próximos desarrollos
        </a>
        <? if (typeof isAuthorized !== 'undefined' && isAuthorized) { ?>
        <a href="#equipo" data-section="equipo" class="nav-link">
          Acceso equipo
        </a>
        <a href="#insights" data-section="insights" class="nav-link">
          Insights
        </a>
        <? } ?>
      </nav>
    </header>

    <main id="app" class="container">
      <!-- Secciones (parciales) -->
      <section id="section-inicio" class="section visible">
        <?!= include('inicio'); ?>
      </section>

      <? if (typeof isAuthorized !== 'undefined' && isAuthorized) { ?>
      <section id="section-equipo" class="section">
        <?!= include('equipo'); ?>
      </section>
      <section id="section-insights" class="section">
        <div class="hero">
          <div style="display:flex; align-items:center; gap:20px;">
            <span class="material-symbols-rounded" style="font-size:48px; color:var(--intelcia-fucsia);">insights</span>
            <div>
              <h1>Insights</h1>
              <p>Análisis de actividad y uso de la aplicación.</p>
            </div>
          </div>
        </div>

        <div class="grid" style="margin-top:20px">
          <div class="col-6">
            <div class="card">
              <h3>Accesos por día/semana</h3>
              <div id="line-chart"></div>
            </div>
          </div>

          <div class="col-6">
            <div class="card">
              <h3>Usuarios únicos por periodo</h3>
              <div id="bar-chart"></div>
            </div>
          </div>

          <div class="col-12">
            <div class="card">
              <h3>Nº de accesos por usuario</h3>
              <div id="histogram-chart"></div>
            </div>
          </div>

          <div class="col-12">
            <div class="card">
              <h3>Mapa de calor (Día x Hora)</h3>
              <div id="heatmap-chart"></div>
            </div>
          </div>
        </div>

        <div class="card" style="margin-top:20px;">
            <h3>Estadísticas Generales</h3>
            <table id="summary-table">
                <tbody>
                    <tr>
                        <td>Total de usuarios</td>
                        <td id="total-users"></td>
                    </tr>
                    <tr>
                        <td>Usuarios nuevos vs. recurrentes</td>
                        <td id="new-vs-recurrent-users"></td>
                    </tr>
                    <tr>
                        <td>Media de accesos por usuario</td>
                        <td id="avg-accesses-per-user"></td>
                    </tr>
                    <tr>
                        <td>Día con más actividad</td>
                        <td id="busiest-day"></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <?!= include('insights-script.html'); ?>
      </section>
      <? } ?>

      <section id="section-proyectos" class="section">
        <?!= include('proyectos'); ?>
      </section>

      <section id="section-documentacion" class="section">
        <?!= include('documentacion'); ?>
      </section>

      <section id="section-proximos" class="section">
        <?!= include('proximos'); ?>
      </section>
    </main>

    <footer class="footer">
      <div>© <span id="year"></span> Intelcia · Departamento de Planificación Logística y Teletrabajo</div>
    </footer>

    <?!= include('scripts'); ?>
  </body>
</html>
